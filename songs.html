<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nhạc Vàng Tuyển Chọn - Kalimba Chill</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="images/logo.jpeg" type="image/jpeg">
    
    <!-- Firebase App (cần thiết cho tất cả các sản phẩm của Firebase) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    
    <!-- Thêm các SDK Firebase mà bạn muốn sử dụng -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    
    <!-- Scripts tùy chỉnh -->
    <script src="js/env-loader.js"></script>
</head>
<body>
    <div class="container">
        <header class="song-list-header">
            <div class="header-left">
                <button class="menu-btn" id="menu-btn">
                    <i class="fas fa-bars"></i>
                </button>
                <button class="back-btn">
                    <i class="fas fa-chevron-left"></i>
                </button>
            </div>
            <div class="header-center">
                <h1>
                    <img src="images/kalimba-chill-logo.jpg" alt="Kalimba Chill Logo" class="mobile-logo">
                    <span class="logo-text">Nhạc Vàng Tuyển Chọn</span>
                </h1>
            </div>
            <div class="header-right">
                <button class="login-btn">
                    <i class="fas fa-sign-in-alt"></i>
                </button>
            </div>
        </header>

        <main class="song-list">
            <div class="list-header">
                <h2>Thành Phố Buồn</h2>
                <p>Đàm Vĩnh Hưng</p>
            </div>
            
            <ul class="songs">
                <li class="song-item">
                    <div class="song-info">
                        <div class="song-title">1. Thành phố [Em]nào nhớ không [G]em Nơi chúng...</div>
                        <div class="song-artist">Đàm Vĩnh Hưng</div>
                    </div>
                    <button class="favorite-btn">
                        <i class="far fa-star"></i>
                    </button>
                </li>
                
                <li class="song-item">
                    <div class="song-info">
                        <div class="song-title">Xuân Này Con Không Về</div>
                        <div class="song-artist">Hoàng Bách</div>
                        <div class="song-chord">Con biết bây giờ mẹ chờ tin [C] con [G/B]...Khi thấu...</div>
                    </div>
                    <button class="favorite-btn">
                        <i class="far fa-star"></i>
                    </button>
                </li>
                
                <li class="song-item">
                    <div class="song-info">
                        <div class="song-title">Con Đường Xưa Em Đi</div>
                        <div class="song-artist">Thanh Tuyền</div>
                        <div class="song-chord">Con đường xưa em [Am]đi vang lên mãi tóc [Dm]tôi buồn...</div>
                    </div>
                    <button class="favorite-btn">
                        <i class="far fa-star"></i>
                    </button>
                </li>
                
                <li class="song-item">
                    <div class="song-info">
                        <div class="song-title">Về Đâu Mái Tóc Người Thương</div>
                        <div class="song-artist">Quang Lê</div>
                        <div class="song-chord">1. Hỏi tự sẽ về đôi mắt [Em]em Chiều nào xóa [B7]em...</div>
                    </div>
                    <button class="favorite-btn">
                        <i class="far fa-star"></i>
                    </button>
                </li>
                
                <li class="song-item">
                    <div class="song-info">
                        <div class="song-title">Đêm Buồn Tỉnh Lẻ</div>
                        <div class="song-artist">Trường Vũ</div>
                        <div class="song-chord">1. Đã lâu [Am] rồi đôi khi cách đôi [C] nơi Tớ duyên...</div>
                    </div>
                    <button class="favorite-btn">
                        <i class="far fa-star"></i>
                    </button>
                </li>
                
                <li class="song-item">
                    <div class="song-info">
                        <div class="song-title">Hoa Sứ Nhà Nàng</div>
                        <div class="song-artist">Đan Nguyên</div>
                        <div class="song-chord">Đêm đêm ngủ mùi [Am]hương, mùi hoa sứ nhà [Dm]nàng...</div>
                    </div>
                    <button class="favorite-btn">
                        <i class="far fa-star"></i>
                    </button>
                </li>
                
                <li class="song-item">
                    <div class="song-info">
                        <div class="song-title">Cô Hàng Xóm</div>
                        <div class="song-artist">Quang Lê</div>
                        <div class="song-chord">Tong góc A#m: Capo 1 Vòng ngoại [Am]ô, tôi [G]ơi cô hàng xóm...</div>
                    </div>
                    <button class="favorite-btn">
                        <i class="far fa-star"></i>
                    </button>
                </li>
                
                <li class="song-item">
                    <div class="song-info">
                        <div class="song-title">Giã Từ Vũ Khí (Một Mai Giã Từ Vũ Khí)</div>
                        <div class="song-artist">Ngân Khánh</div>
                        <div class="song-chord">1. Rồi có một [Dm] ngày, sẽ một [C] ngày chính chiến...</div>
                    </div>
                    <button class="favorite-btn">
                        <i class="far fa-star"></i>
                    </button>
                </li>
                
                <li class="song-item">
                    <div class="song-info">
                        <div class="song-title">Giã Từ</div>
                        <div class="song-artist">Quang Lê</div>
                        <div class="song-chord">Tuổi đời chán dơn [Am]cõi Gót mòn dại lộ [F]buồn...</div>
                    </div>
                    <button class="favorite-btn">
                        <i class="far fa-star"></i>
                    </button>
                </li>
                
                <li class="song-item">
                    <div class="song-info">
                        <div class="song-title">Hoa Trinh Nữ</div>
                        <div class="song-artist">Như Quỳnh</div>
                    </div>
                    <button class="favorite-btn">
                        <i class="far fa-star"></i>
                    </button>
                </li>
            </ul>
        </main>
    </div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="user-profile">
                <div class="user-avatar">
                    <i class="fab fa-google"></i>
                </div>
                <button class="login-with-google-btn">
                    <i class="fab fa-google"></i> Đăng nhập bằng Google
                </button>
            </div>
        </div>
        <nav class="sidebar-menu">
            <ul>
                <li><a href="index.html"><i class="fas fa-home"></i> Trang chủ</a></li>
                <li><a href="#" class="active"><i class="fas fa-music"></i> Bài hát</a></li>
                <li><a href="#"><i class="fas fa-book"></i> Khóa học</a></li>
                <li><a href="#"><i class="fas fa-list"></i> Playlist của tôi</a></li>
                <li><a href="#"><i class="fas fa-heart"></i> Yêu thích</a></li>
                <li><a href="#"><i class="fas fa-search"></i> Tìm theo hợp âm</a></li>
                <li><a href="#"><i class="fas fa-guitar"></i> Tra cứu hợp âm</a></li>
                <li><a href="index.html#donate"><i class="fas fa-hand-holding-heart"></i> Đóng góp</a></li>
                <li><a href="feedback.html"><i class="fas fa-comment-dots"></i> Góp ý</a></li>
                <li><a href="#"><i class="fas fa-cog"></i> Thiết lập</a></li>
            </ul>
        </nav>
    </div>
    <div class="overlay" id="overlay"></div>

    <script src="js/script.js"></script>
    
    <!-- Firebase initialization -->
    <script type="module">
        // Khởi tạo Firebase dựa trên cấu hình từ env-loader.js
        document.addEventListener('DOMContentLoaded', function() {
            // Kiểm tra xem đã tải được cấu hình chưa
            setTimeout(() => {
                const firebaseConfig = window.getFirebaseConfig ? window.getFirebaseConfig() : {
                    apiKey: window.getEnv ? window.getEnv('FIREBASE_API_KEY') : '',
                    authDomain: window.getEnv ? window.getEnv('FIREBASE_AUTH_DOMAIN') : '',
                    projectId: window.getEnv ? window.getEnv('FIREBASE_PROJECT_ID') : '',
                    storageBucket: window.getEnv ? window.getEnv('FIREBASE_STORAGE_BUCKET') : '',
                    messagingSenderId: window.getEnv ? window.getEnv('FIREBASE_MESSAGING_SENDER_ID') : '',
                    appId: window.getEnv ? window.getEnv('FIREBASE_APP_ID') : '',
                    measurementId: window.getEnv ? window.getEnv('FIREBASE_MEASUREMENT_ID') : ''
                };
                
                // Khởi tạo Firebase
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                    console.log('Firebase đã được khởi tạo thành công.');
                }
            }, 1000); // Đợi 1 giây để đảm bảo env-loader đã chạy
        });
    </script>
    
    <!-- Firebase authentication -->
    <script type="module" src="js/firebase-auth.js"></script>
    
    <!-- Firestore operations -->
    <script type="module" src="js/firestore-operations.js"></script>
    
    <!-- Script xử lý danh sách bài hát -->
    <script type="module">
        import { getSongsByCategory, checkFavoriteStatus, toggleFavoriteSong } from './js/firestore-operations.js';
        
        document.addEventListener('DOMContentLoaded', async function() {
            // Lấy ID danh mục từ URL hoặc sử dụng một danh mục mặc định
            const urlParams = new URLSearchParams(window.location.search);
            const categoryId = urlParams.get('category') || 'nhac-vang';
            
            try {
                // Tải danh sách bài hát từ Firestore
                const songs = await getSongsByCategory(categoryId);
                
                if (songs.length > 0) {
                    // Cập nhật tiêu đề danh mục
                    document.querySelector('.list-header h2').textContent = songs[0].categoryName || 'Danh sách bài hát';
                    
                    // Xóa danh sách bài hát hiện tại
                    const songsList = document.querySelector('.songs');
                    songsList.innerHTML = '';
                    
                    // Thêm các bài hát vào danh sách
                    songs.forEach(song => {
                        const songItem = createSongItem(song);
                        songsList.appendChild(songItem);
                    });
                    
                    // Thêm xử lý sự kiện cho các nút yêu thích
                    setupFavoriteButtons();
                } else {
                    // Hiển thị thông báo nếu không có bài hát
                    const songsList = document.querySelector('.songs');
                    songsList.innerHTML = '<li class="no-songs">Không có bài hát nào trong danh mục này.</li>';
                }
            } catch (error) {
                console.error('Lỗi khi tải danh sách bài hát:', error);
            }
        });
        
        // Tạo HTML cho một mục bài hát
        function createSongItem(song) {
            const li = document.createElement('li');
            li.className = 'song-item';
            li.dataset.id = song.id;
            
            const html = `
                <div class="song-info">
                    <div class="song-title">${song.title}</div>
                    <div class="song-artist">${song.artist}</div>
                    ${song.preview ? `<div class="song-chord">${song.preview}</div>` : ''}
                </div>
                <button class="favorite-btn">
                    <i class="far fa-star"></i>
                </button>
            `;
            
            li.innerHTML = html;
            
            // Thêm sự kiện click để chuyển đến trang chi tiết
            li.addEventListener('click', (event) => {
                // Không chuyển trang nếu click vào nút yêu thích
                if (!event.target.closest('.favorite-btn')) {
                    window.location.href = `song-detail.html?id=${song.id}`;
                }
            });
            
            return li;
        }
        
        // Thiết lập xử lý sự kiện cho các nút yêu thích
        async function setupFavoriteButtons() {
            const favoriteButtons = document.querySelectorAll('.favorite-btn');
            
            favoriteButtons.forEach(button => {
                const songItem = button.closest('.song-item');
                const songId = songItem.dataset.id;
                
                // Kiểm tra trạng thái yêu thích ban đầu
                checkFavoriteStatus(songId).then(isFavorite => {
                    const icon = button.querySelector('i');
                    if (isFavorite) {
                        icon.classList.remove('far');
                        icon.classList.add('fas');
                    }
                });
                
                // Xử lý sự kiện click
                button.addEventListener('click', async (event) => {
                    event.stopPropagation(); // Ngăn sự kiện click lan ra phần tử cha
                    
                    try {
                        const isFavorite = await toggleFavoriteSong(songId);
                        const icon = button.querySelector('i');
                        
                        if (isFavorite === true) {
                            // Đã thêm vào yêu thích
                            icon.classList.remove('far');
                            icon.classList.add('fas');
                        } else if (isFavorite === false) {
                            // Đã xóa khỏi yêu thích
                            icon.classList.remove('fas');
                            icon.classList.add('far');
                        }
                    } catch (error) {
                        console.error('Lỗi khi thay đổi trạng thái yêu thích:', error);
                    }
                });
            });
        }
    </script>
</body>
</html> 