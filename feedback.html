<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Góp ý - Kalimba Chill</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="images/logo.jpeg" type="image/jpeg">
    
    <!-- Script để xóa bộ nhớ cache -->
    <script src="js/clear-cache.js"></script>
    <script src="js/auth-watchdog.js"></script>
    <script src="js/auth-login-helper.js"></script>
    <script src="js/error-handler.js"></script>
    <script src="js/firebase-constants.js"></script>
    
    <!-- Firebase App (cần thiết cho tất cả các sản phẩm của Firebase) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    
    <!-- Thêm các SDK Firebase mà bạn muốn sử dụng -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-analytics-compat.js"></script>
    
    <!-- Scripts tùy chỉnh -->
    <script src="js/firebase-auth.js"></script>
    <script src="js/firestore-operations.js"></script>
    <script src="js/script.js"></script>
</head>
<body>
    <div class="container">
        <!-- Mobile Header -->
        <header class="mobile-header">
            <div class="header-left">
                <button class="menu-btn" id="menu-btn">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            <div class="header-center">
                <h1>
                    <img src="images/kalimba-chill-logo.jpg" alt="Kalimba Chill Logo" class="mobile-logo">
                    <span class="logo-text"><span class="highlight">Kalimba</span> Chill</span>
                </h1>
            </div>
            <div class="header-right">
                <button class="login-btn">
                    <i class="fas fa-sign-in-alt"></i>
                </button>
            </div>
        </header>

        <!-- Desktop Header -->
        <header class="desktop-header">
            <div class="container">
                <div class="logo">
                    <a href="index.html">
                        <img src="images/kalimba-chill-logo.jpg" alt="Kalimba Chill Logo" class="desktop-logo">
                        <span class="logo-text"><span class="highlight">Kalimba</span> Chill</span>
                    </a>
                </div>
                <nav>
                    <ul>
                        <li><a href="index.html"><i class="fas fa-home"></i> Trang chủ</a></li>
                        <li><a href="index.html#donate"><i class="fas fa-hand-holding-heart"></i> Đóng góp</a></li>
                        <li><a href="feedback.html" class="active"><i class="fas fa-comment-dots"></i> Góp ý</a></li>
                    </ul>
                </nav>
                <div class="header-right">
                    <button class="login-with-google-btn">
                        <i class="fab fa-google"></i> Đăng nhập
                    </button>
                </div>
            </div>
        </header>

        <!-- Feedback Content Section -->
        <section class="feedback-section">
            <div class="section-header">
                <h1>Đóng góp ý kiến</h1>
                <p>Ý kiến của bạn sẽ giúp chúng tôi cải thiện và phát triển Kalimba Chill tốt hơn. Cảm ơn bạn đã dành thời gian!</p>
            </div>
            
            <div class="feedback-content">
                <div class="feedback-form">
                    <form id="feedback-form" action="#" method="post">
                        <div class="form-group">
                            <label for="name">Họ và tên <span class="required">*</span></label>
                            <input type="text" id="name" name="name" placeholder="Nhập họ và tên của bạn" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="email">Email <span class="required">*</span></label>
                            <input type="email" id="email" name="email" placeholder="Nhập địa chỉ email của bạn" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="phone">Số điện thoại</label>
                            <input type="tel" id="phone" name="phone" placeholder="Nhập số điện thoại của bạn">
                        </div>
                        
                        <div class="form-group">
                            <label for="feedback-type">Loại phản hồi <span class="required">*</span></label>
                            <select id="feedback-type" name="feedback-type" required>
                                <option value="" disabled selected>Chọn loại phản hồi</option>
                                <option value="suggestion">Đề xuất cải thiện</option>
                                <option value="bug">Báo cáo lỗi</option>
                                <option value="content">Yêu cầu nội dung mới</option>
                                <option value="compliment">Lời khen</option>
                                <option value="other">Khác</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="subject">Tiêu đề <span class="required">*</span></label>
                            <input type="text" id="subject" name="subject" placeholder="Nhập tiêu đề phản hồi" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="message">Nội dung phản hồi <span class="required">*</span></label>
                            <textarea id="message" name="message" rows="6" placeholder="Nhập nội dung phản hồi chi tiết của bạn" required></textarea>
                        </div>
                        
                        <div class="form-group file-upload">
                            <label for="attachment">Đính kèm (nếu có)</label>
                            <input type="file" id="attachment" name="attachment">
                            <div class="file-info">Hỗ trợ: JPG, PNG, PDF. Kích thước tối đa: 5MB</div>
                        </div>
                        
                        <div class="form-group checkbox">
                            <input type="checkbox" id="consent" name="consent" required>
                            <label for="consent">Tôi đồng ý với <a href="#" class="text-link">chính sách quyền riêng tư</a> của Kalimba Chill <span class="required">*</span></label>
                        </div>
                        
                        <div class="form-submit">
                            <button type="submit" class="submit-btn">Gửi phản hồi</button>
                        </div>
                    </form>
                </div>
                
                <div class="feedback-info">
                    <div class="info-card">
                        <h3><i class="fas fa-info-circle"></i> Thông tin thêm</h3>
                        <p>Chúng tôi luôn trân trọng mọi ý kiến đóng góp từ cộng đồng. Phản hồi của bạn sẽ được xem xét và phản hồi trong thời gian sớm nhất.</p>
                        
                        <div class="contact-methods">
                            <div class="contact-method">
                                <i class="fas fa-envelope"></i>
                                <div class="method-info">
                                    <h4>Email</h4>
                                    <p>feedback@kalimbachill.com</p>
                                </div>
                            </div>
                            
                            <div class="contact-method">
                                <i class="fas fa-phone"></i>
                                <div class="method-info">
                                    <h4>Hotline</h4>
                                    <p>+84 123 456 789</p>
                                </div>
                            </div>
                            
                            <div class="contact-method">
                                <i class="fab fa-facebook-messenger"></i>
                                <div class="method-info">
                                    <h4>Messenger</h4>
                                    <p><a href="#">m.me/kalimbachill</a></p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="faq-section">
                            <h4>Câu hỏi thường gặp</h4>
                            <ul>
                                <li><a href="#">Làm thế nào để yêu cầu thêm bài hát mới?</a></li>
                                <li><a href="#">Thời gian phản hồi góp ý là bao lâu?</a></li>
                                <li><a href="#">Tôi có thể đề xuất tính năng mới không?</a></li>
                                <li><a href="#">Xem tất cả câu hỏi <i class="fas fa-arrow-right"></i></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="site-footer">
            <div class="footer-content">
                <div class="footer-logo">
                    <div class="footer-logo-img">
                        <img src="images/kalimba-chill-logo.jpg" alt="Kalimba Chill Logo" class="footer-logo-image">
                    </div>
                    <h2>Kalimba Chill</h2>
                    <p>Website hợp âm và tab nhạc đàn Kalimba hàng đầu Việt Nam</p>
                </div>
                <div class="footer-links">
                    <h3>Liên kết</h3>
                    <ul>
                        <li><a href="index.html">Trang chủ</a></li>
                        <li><a href="#">Danh sách bài hát</a></li>
                        <li><a href="#">Khóa học</a></li>
                        <li><a href="index.html#donate">Đóng góp</a></li>
                        <li><a href="feedback.html">Góp ý</a></li>
                    </ul>
                </div>
                <div class="footer-contact">
                    <h3>Liên hệ</h3>
                    <p><i class="fas fa-envelope"></i> info@kalimbachill.com</p>
                    <p><i class="fas fa-phone"></i> +84 123 456 789</p>
                    <div class="social-icons">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-tiktok"></i></a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2023 Kalimba Chill. Tất cả các quyền được bảo lưu.</p>
            </div>
        </footer>

        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="user-profile">
                    <div class="user-avatar">
                        <i class="fab fa-google"></i>
                    </div>
                    <button class="login-with-google-btn">
                        <i class="fab fa-google"></i> Đăng nhập bằng Google
                    </button>
                </div>
            </div>
            <nav class="sidebar-menu">
                <ul>
                    <li><a href="index.html"><i class="fas fa-home"></i> Trang chủ</a></li>
                    <li><a href="#"><i class="fas fa-music"></i> Bài hát</a></li>
                    <li><a href="#"><i class="fas fa-book"></i> Khóa học</a></li>
                    <li><a href="#"><i class="fas fa-list"></i> Playlist của tôi</a></li>
                    <li><a href="#"><i class="fas fa-heart"></i> Yêu thích</a></li>
                    <li><a href="#"><i class="fas fa-search"></i> Tìm theo hợp âm</a></li>
                    <li><a href="#"><i class="fas fa-guitar"></i> Tra cứu hợp âm</a></li>
                    <li><a href="index.html#donate"><i class="fas fa-hand-holding-heart"></i> Đóng góp</a></li>
                    <li><a href="feedback.html" class="active"><i class="fas fa-comment-dots"></i> Góp ý</a></li>
                    <li><a href="#"><i class="fas fa-cog"></i> Thiết lập</a></li>
                </ul>
            </nav>
        </div>
        <div class="overlay" id="overlay"></div>
    </div>

    <script src="js/script.js"></script>
    <script>
        // Form validation and submission handling
        document.getElementById('feedback-form').addEventListener('submit', function(event) {
            event.preventDefault();
            
            // In a real application, this would send data to a backend API
            // For now, we'll just show a success message
            alert('Cảm ơn bạn đã gửi phản hồi! Chúng tôi sẽ xem xét và phản hồi sớm nhất có thể.');
            this.reset();
        });
        
        // File upload preview
        document.getElementById('attachment').addEventListener('change', function() {
            const fileInfo = document.querySelector('.file-info');
            if (this.files.length > 0) {
                const file = this.files[0];
                const fileSize = (file.size / 1024 / 1024).toFixed(2);
                fileInfo.textContent = `File: ${file.name} (${fileSize}MB)`;
            } else {
                fileInfo.textContent = 'Hỗ trợ: JPG, PNG, PDF. Kích thước tối đa: 5MB';
            }
        });
    </script>
    
    <!-- Firebase initialization -->
    <script>
        // Khởi tạo Firebase với cấu hình từ firebase-constants.js
        document.addEventListener('DOMContentLoaded', function() {
            // Lấy cấu hình từ firebase-constants.js
            const firebaseConfig = window.getFirebaseConfig();
            
            // Khởi tạo Firebase nếu chưa được khởi tạo
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
                console.log('Firebase đã được khởi tạo thành công từ firebase-constants.js');
                
                // Khởi tạo Analytics nếu có id
                if (firebaseConfig.measurementId) {
                    firebase.analytics();
                }
            }
        });
    </script>
    
    <!-- Xử lý gửi phản hồi -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Đảm bảo rằng các hàm Firestore đã được tải
            if (!window.firestoreOperations) {
                console.error('Firestore operations chưa được tải');
                return;
            }
            
            const feedbackForm = document.getElementById('feedback-form');
            const submitButton = feedbackForm.querySelector('.submit-btn');
            
            // Xử lý gửi form
            feedbackForm.addEventListener('submit', async function(event) {
                event.preventDefault();
                
                // Vô hiệu hóa nút gửi để tránh gửi nhiều lần
                submitButton.disabled = true;
                submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Đang gửi...';
                
                try {
                    // Thu thập dữ liệu từ form
                    const formData = {
                        name: feedbackForm.name.value,
                        email: feedbackForm.email.value,
                        phone: feedbackForm.phone.value,
                        feedbackType: feedbackForm['feedback-type'].value,
                        subject: feedbackForm.subject.value,
                        message: feedbackForm.message.value
                    };
                    
                    // Xử lý file đính kèm nếu có
                    const attachmentInput = feedbackForm.attachment;
                    if (attachmentInput.files.length > 0) {
                        const file = attachmentInput.files[0];
                        
                        // Kiểm tra kích thước file (tối đa 5MB)
                        if (file.size > 5 * 1024 * 1024) {
                            throw new Error('Kích thước file vượt quá giới hạn 5MB.');
                        }
                        
                        // Kiểm tra loại file
                        const allowedTypes = ['image/jpeg', 'image/png', 'application/pdf'];
                        if (!allowedTypes.includes(file.type)) {
                            throw new Error('Loại file không được hỗ trợ. Vui lòng sử dụng JPG, PNG hoặc PDF.');
                        }
                        
                        // Tải file lên Firebase Storage
                        const timestamp = new Date().getTime();
                        const filePath = `feedback-attachments/${timestamp}_${file.name}`;
                        const fileUrl = await window.firestoreOperations.uploadFile(file, filePath);
                        
                        // Thêm URL vào dữ liệu phản hồi
                        formData.attachment = {
                            fileName: file.name,
                            fileType: file.type,
                            fileSize: file.size,
                            fileUrl: fileUrl
                        };
                    }
                    
                    // Gửi phản hồi lên Firestore
                    await window.firestoreOperations.submitFeedback(formData);
                    
                    // Hiển thị thông báo thành công
                    alert('Cảm ơn bạn đã gửi phản hồi! Chúng tôi sẽ xem xét và phản hồi sớm nhất có thể.');
                    
                    // Reset form
                    feedbackForm.reset();
                    document.querySelector('.file-info').textContent = 'Hỗ trợ: JPG, PNG, PDF. Kích thước tối đa: 5MB';
                    
                } catch (error) {
                    console.error('Lỗi khi gửi phản hồi:', error);
                    alert('Đã xảy ra lỗi khi gửi phản hồi: ' + error.message);
                } finally {
                    // Khôi phục nút gửi
                    submitButton.disabled = false;
                    submitButton.innerHTML = 'Gửi phản hồi';
                }
            });
        });
    </script>
</body>
</html> 